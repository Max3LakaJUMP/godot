# SCsub
Import('env')
import os
from compat import isbasestring
module_env = env.Clone()

if env["tools"]:
    libpsd_sources = []
    for file in os.listdir(os.path.join(Dir('.').abspath, "libpsd", "src")):
        if file.endswith(".c"):
            libpsd_sources.append(os.path.join("libpsd", "src", file))
    for path in ["libpsd/include", "facegen"]:
        module_env.Prepend(CPPPATH=[path])
        env.Prepend(CPPPATH=[path])
	
	
    env_thirdparty = module_env.Clone()
    env_thirdparty.disable_warnings()
    env_thirdparty.add_source_files(env.modules_sources, libpsd_sources)
    module_env.add_source_files(env.modules_sources, "*.cpp")
	
    # inserted = False
    # for idx, linklib in enumerate(env["LIBS"]):
    #   if isbasestring(linklib): # first system lib such as "X11", otherwise SCons lib object
    #         env["LIBS"].insert(idx, lib)
    #         inserted = True
    #         break
    # if not inserted:
    #     env.Append(LIBS=[lib])
    # lib = env_thirdparty.add_library("psd", libpsd_sources)
    # print(lib)
    # module_env.Prepend(LIBS=["facegen.lib"])


else:
    module_env.add_source_files(env.modules_sources, "register_types.cpp")



